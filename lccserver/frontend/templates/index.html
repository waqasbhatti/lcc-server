{% extends 'base.html' %}

{% block pagecss %}

<!-- Codemirror CSS -->
<link rel="stylesheet" href="{{ static_url('css/codemirror.css') }}">

{% end %}


{% block pagecontent %}

<!-- the top bar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">

  <a class="navbar-brand" href="/">{{ page_title }}</a>

  <button class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      <a class="nav-item nav-link active" href="/">
        Home <span class="sr-only">(current)</span>
      </a>
      <a class="nav-item nav-link" href="/docs">Docs</a>
    </div>
  </div>

  <form class="form-inline" action="/api/quicksearch" method="post">

    {% module xsrf_form_html() %}

    <select class="custom-select form-control" id="qt" name="qt">
      <option value="conesearch" selected>Quick cone search</option>
      <option value="objectidsearch">Quick object search</option>
      <option value="xmatchsearch">Quick cross-match search</option>
    </select>

    <div class="input-group">

      <input class="form-control ml-sm-2" id="q" name="q"
             type="search"
             placeholder="[RA] [Dec] [optional radius (arcmin)]"
             aria-label="Search">
      <div class="input-group-append">
        <button class="btn btn-outline-success my-2 my-sm-0"
                type="submit">Go</button>
      </div>

    </div>

  </form>

</nav>


<!-- this is where all the alerts go -->
<div class="container">
  <div class="row">
    <div class="col-12">
      <div id="alert-box">

      </div>
    </div>
  </div>
</div>

<!-- the main search form -->
<div class="container-fluid">
  <div class="row top-margin-row search-controls">

    <div class="col-12">

      <ul class="nav nav-tabs" id="myTab" role="tablist">

        <li class="nav-item">
          <a class="nav-link active tab-link"
             id="collections-tab"
             data-toggle="tab"
             href="#collections"
             role="tab"
             aria-controls="collections"
             aria-selected="true">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-shopping_cart-24px.svg') }}"><br>
            Collections
          </a>
        </li>

        <li class="nav-item mr-auto">
          <a class="nav-link tab-link"
             id="datasets-tab"
             data-toggle="tab"
             href="#datasets"
             role="tab"
             aria-controls="datasets"
             aria-selected="false">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-archive-24px.svg') }}"><br>
            Datasets
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link tab-link"
             id="conesearch-tab"
             data-toggle="tab"
             href="#conesearch"
             role="tab"
             aria-controls="conesearch"
             aria-selected="false">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-brightness_high-24px.svg') }}"><br>
            Search near coordinates
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link tab-link"
             id="fts-tab"
             data-toggle="tab"
             href="#fts"
             role="tab"
             aria-controls="fts"
             aria-selected="false">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-language-24px.svg') }}"><br>
            Search by ID
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link tab-link"
             id="columns-tab"
             data-toggle="tab"
             href="#columns"
             role="tab"
             aria-controls="columns"
             aria-selected="true">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-view_week-24px.svg') }}"><br>
            Search DB columns
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link tab-link"
             id="xmatch-tab"
             data-toggle="tab"
             href="#xmatch"
             role="tab"
             aria-controls="xmatch"
             aria-selected="false">
            <img class="icon-svg"
                 src="{{ static_url('images/twotone-cloud_upload-24px.svg') }}"><br>
            Find cross-matches
          </a>
        </li>

        <li class="nav-item ml-auto">
          <a class="nav-link tab-link"
             id="results-tab"
             data-toggle="tab"
             href="#results"
             role="tab"
             aria-controls="results"
             aria-selected="false">
            <span id="search-notifications">
              <img id="search-notification-icon"
                   class="icon-svg"
                   src="{{ static_url('images/twotone-sync-24px.png') }}"><br>
              <span id="search-notification-text">Query status</span>
            </span>
          </a>
        </li>


        <!-- <li class="nav-item"> -->
          <!--   <a class="nav-link tab-link" -->
          <!--      id="sql-tab" -->
          <!--      data-toggle="tab" -->
          <!--      href="#sql" -->
          <!--      role="tab" -->
          <!--      aria-controls="sql" -->
          <!--      aria-selected="false"> -->
            <!--     <img class="icon-svg"
                     src="{{ static_url('images/twotone-search-24px.svg') }}"><br> -->
            <!--     Run an SQL query -->
            <!--   </a> -->
          <!-- </li> -->

      </ul>


      <div class="tab-content" id="myTabContent">

        <div class="tab-pane show active"
             id="collections" role="tabpanel" aria-labelledby="collections-tab">

          <div class="row mt-2">
            <div class="col-12">

              <h3>Available light curve collections</h3>

              <table id="lcc-collections-table" class="table table-sm">

                <thead class="bg-light">
                  <tr>
                    <th scope="col" width="80">Name</th>
                    <th scope="col" width="100">Description</th>
                    <th scope="col" width="100">Coordinates<br>(&alpha;, &delta;) [decimal deg]</th>
                    <th scope="col" width="250">Columns<br>
                      (<span class="kdtree-col">indexed columns</span>, <span class="fts-col" data-toggle="tooltip" title="full text search is available for these columns">FTS indexed columns</span>)

                    </th>
                  </tr>
                </thead>

                <tbody id="lcc-collection-tablerows">

                </tbody>

              </table>

            </div>
          </div>

        </div>

        <div class="tab-pane"
             id="datasets" role="tabpanel" aria-labelledby="datasets-tab">

          <div class="row mt-2">
            <div class="col-12">

              <h3>Datasets from recent search queries</h3>

              <table id="lcc-datasets-table" class="table table-hover table-sm">

                <thead class="bg-light">
                  <tr>
                    <th scope="col" width="100">Set ID</th>
                    <th scope="col" width="80">Objects</th>
                    <th scope="col" width="200">Query</th>
                    <th scope="col" width="150">Products</th>
                    <th scope="col" width="150">Last updated</th>
                  </tr>
                </thead>

                <tbody id="lcc-datasets-tablerows">

                </tbody>

              </table>

            </div>
          </div>

        </div>

        <div class="tab-pane"
             id="conesearch" role="tabpanel" aria-labelledby="conesearch-tab">

          <div class="row mt-2">
            <div class="col-12">
              <h3>Run a cone-search query</h3>
            </div>
          </div>

          <!-- main search controls -->
          <div class="row mt-2">

            <div class="col-sm-8">
              coordinates box centered on page
            </div>

            <div class="col-sm-4">
              button postfix to the coordinate box
            </div>

          </div>

          <!-- advanced options -->
          <div class="row mt-2">

            <div class="col-sm-12 col-md-4">
              <h4>Use LC collections</h4>
              use collections
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Retrieve database columns</h4>
              retrieve these columns
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Apply extra filters</h4>
              apply the following conditions to results
            </div>

          </div>

          <!-- box for immediate feedback on status and problems -->
          <div class="row mt-2">
            <div class="col-sm-12">
              <div id="conesearch-feedback-box">
              </div>
            </div>
          </div>

        </div>

        <div class="tab-pane"
             id="fts" role="tabpanel" aria-labelledby="fts-tab">

          <div class="row mt-2">
            <div class="col-12">
              <h3>Search for object names, descriptions, or tags</h3>
            </div>
          </div>

          <!-- main search controls -->
          <div class="row mt-2">

            <div class="col-sm-8">
              coordinates box centered on page
            </div>

            <div class="col-sm-4">
              button postfix to the coordinate box
            </div>

          </div>

          <!-- advanced options -->
          <div class="row mt-2">

            <div class="col-sm-12 col-md-4">
              <h4>Use LC collections</h4>
              use collections
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Retrieve database columns</h4>
              retrieve these columns
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Apply extra filters</h4>
              apply the following conditions to results
            </div>

          </div>

          <!-- box for immediate feedback on status and problems -->
          <div class="row mt-2">
            <div class="col-sm-12">
              <div id="ftsearch-feedback-box">
              </div>
            </div>
          </div>

        </div>

        <div class="tab-pane"
             id="columns" role="tabpanel" aria-labelledby="columns-tab">

          <div class="row mt-2">
            <div class="col-12">
              <h3>Build a query using database columns and filter conditions</h3>
            </div>
          </div>

          <!-- advanced options -->
          <div class="row mt-2">

            <div class="col-sm-12 col-md-4">
              <h4>Use LC collections</h4>
              use collections
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Retrieve database columns</h4>
              retrieve these columns
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Apply extra filters</h4>
              apply the following conditions to results
            </div>

          </div>

          <!-- main search controls -->
          <div class="row mt-2">

            <div class="col-sm-8">
            </div>

            <div class="col-sm-4">
              search button right justified
            </div>

          </div>

          <!-- box for immediate feedback on status and problems -->
          <div class="row mt-2">
            <div class="col-sm-12">
              <div id="columnsearch-feedback-box">
              </div>
            </div>
          </div>

        </div>

        <div class="tab-pane"
             id="xmatch" role="tabpanel" aria-labelledby="xmatch-tab">

          <div class="row mt-2">
            <div class="col-12">
              <h3>Upload and cross-match catalogs against LC collections</h3>
            </div>
          </div>

          <!-- main search controls -->
          <div class="row mt-2">

            <div class="col-sm-6">
              input box for objectid, ra, decl
            </div>

            <div class="col-sm-6">
              xmatch options box and submit button
            </div>

          </div>

          <!-- advanced options -->
          <div class="row mt-2">

            <div class="col-sm-12 col-md-4">
              <h4>Use LC collections</h4>
              use collections
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Retrieve database columns</h4>
              retrieve these columns
            </div>

            <div class="col-sm-12 col-md-4">
              <h4>Apply extra filters</h4>
              apply the following conditions to results
            </div>

          </div>

          <!-- box for immediate feedback on status and problems -->
          <div class="row mt-2">
            <div class="col-sm-12">
              <div id="ftsearch-feedback-box">
              </div>
            </div>
          </div>

        </div>

        <!-- <div class="tab-pane" -->
        <!--      id="sql" role="tabpanel" aria-labelledby="sql-tab"> -->

          <!--   <div class="row mt-2"> -->
            <!--     <div class="col-12"> -->
              <!--       sql -->
              <!--     </div> -->
            <!--   </div> -->

          <!-- </div> -->

        <div class="tab-pane"
             id="results" role="tabpanel" aria-labelledby="results-tab">

          <div class="row mt-2">
            <div class="col-12">
              <h3>View status and results of running or completed queries</h3>
            </div>
          </div>

          <div class="row mt-2">
            <div class="col-12">
              table for queries with cols: submitted_at, query_type,
              query_params, status, message, setid
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>

</div>


{% end %}


{% block pagejs_modules %}

<!-- mathjs -->
<script src="{{ static_url('js/math.min.js') }}"></script>

<!-- code mirror js -->
<script src="{{ static_url('js/codemirror.min.js') }}"></script>

<!-- our own js modules -->
<script src="{{ static_url('js/lcc-server.js') }}"></script>

{% end %}


{% block pagejs %}

$(document).ready(function() {

// get the light curve collections
lcc_ui.get_lc_collections();

// get the most recent 25 datasets
lcc_ui.get_recent_datasets(25);

// UI action setup
lcc_ui.action_setup();



});

{% end %}
