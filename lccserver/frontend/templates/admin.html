{% extends 'base.html' %}

{% block pagecontent %}

<div class="container-fluid" >

  <div class="row mt-2 justify-content-center" id="alert-box">
    <div class="col-sm-12 col-md-9" >
      {% raw flash_messages %}
    </div>
  </div>

  {% if current_user['user_role'] == 'superuser' %}
  <div class="row mt-2" >

    <div class="col-sm-12 col-md-4" >
      <h3>LCC-Server site settings</h3>
      <form action="/admin/site" method="post" id="admin-site-update-form">
        {% module xsrf_form_html() %}

        <div class="form-group" >
          <label for="projectname" >Project name</label>
          <input type="text" class="form-control"
                 name="projectname" id="projectname" required
                 placeholder="The project's name"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['project'] }}">
        </div>

        <div class="form-group" >
          <label for="projectlink" >Project link URL</label>
          <input type="text" class="form-control"
                 name="projectlink" id="projectlink" required
                 placeholder="The project's URL"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['project_link'] }}">
        </div>

        <div class="form-group" >
          <label for="institution" >Institution</label>
          <input type="text" class="form-control"
                 name="institution" id="institution" required
                 placeholder="The institution affiliated with this project"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['institution'] }}">
        </div>

        <div class="form-group" >
          <label for="institutionlink" >Institution link URL</label>
          <input type="text" class="form-control"
                 name="institutionlink" id="institutionlink" required
                 placeholder="URL for the institution's website"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['institution_link'] }}">
        </div>

        <div class="form-group" >
          <label for="institutionlogo" >Institution logo file in <code>site-static</code> folder</label>
          <input type="text" class="form-control"
                 name="institutionlogo" id="institutionlogo"
                 placeholder="Path to the institution logo in server's site-static directory"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['institution_logo'] }}">
        </div>

        <div class="form-group" >
          <label for="department" >Department</label>
          <input type="text" class="form-control"
                 name="department" id="department" required
                 placeholder="The department of the institution"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['department'] }}">
        </div>

        <div class="form-group" >
          <label for="departmentlink" >Department link URL</label>
          <input type="text" class="form-control"
                 name="departmentlink" id="departmentlink" required
                 placeholder="URL for the institution's department"
                 minlength="5" maxlength="1024"
                 value="{{ siteinfo['department_link'] }}">
        </div>

        <button type="submit" class="btn btn-primary" id="admin-site-update" >
          Update LCC-Server site settings
        </button>


      </form>
    </div>

    <div class="col-sm-12 col-md-4" >
      <h3>LCC-Server user accounts</h3>
      <form action="/admin/users" method="post" id="admin-users-update-form">
        <!-- contains a table of users, when they signed up, how many datasets they have
             and controls to remove or lock their user accounts
        -->
      </form>
    </div>

    <div class="col-sm-12 col-md-4" >
      <h3>Users and email server settings</h3>
      <form action="/admin/email" method="post" id="admin-email-update-form">
        {% module xsrf_form_html() %}

        <fieldset>
          <legend>Are <strong>existing users</strong> allowed to sign in?</legend>

          {% if siteinfo['logins_allowed'] is True %}

          <div class="form-check form-check-inline">
            <input type="radio" id="loginradio-yes" value="login-allowed" name="loginradio" class="form-check-input" checked>
            <label class="form-check-label" for="loginradio-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" id="loginradio-no" value="login-disallowed" name="loginradio" class="form-check-input">
            <label class="form-check-label" for="loginradio-no">No</label>
          </div>

          {% else %}

          <div class="form-check form-check-inline">
            <input type="radio" id="loginradio-yes" value="login-allowed" name="loginradio" class="form-check-input">
            <label class="form-check-label" for="loginradio-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" id="loginradio-no" value="login-disallowed" name="loginradio" class="form-check-input" checked>
            <label class="form-check-label" for="loginradio-no">No</label>
          </div>

          {% end %}

        </fieldset>

        <fieldset>
          <legend>Are <strong>new users</strong> allowed to sign up?</legend>

          {% if siteinfo['signups_allowed'] is True %}

          <div class="form-check form-check-inline">
            <input type="radio" id="signupradio-yes" value="signup-allowed" name="signupradio" class="form-check-input" checked>
            <label class="form-check-label" for="signupradio-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" id="signupradio-no" value="signup-disallowed" name="signupradio" class="form-check-input">
            <label class="form-check-label" for="signupradio-no">No</label>
          </div>

          {% else %}

          <div class="form-check form-check-inline">
            <input type="radio" id="signupradio-yes" value="signup-allowed" name="signupradio" class="form-check-input">
            <label class="form-check-label" for="signupradio-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" id="signupradio-no" value="signup-disallowed" name="signupradio" class="form-check-input" checked>
            <label class="form-check-label" for="signupradio-no">No</label>
          </div>

          {% end %}

        </fieldset>

        <fieldset>
          <legend>Email server settings</legend>

          <div class="form-group" >
            <label for="emailsender" >Email sender address</label>
            <input type="email" class="form-control"
                   name="emailsender" id="emailsender" required
                   placeholder="The email address used in outgoing emails"
                   minlength="5" maxlength="1024"
                   value="{{ siteinfo['email_sender'] }}">
          </div>

          <div class="form-group" >
            <label for="emailserver" >Email server</label>
            <input type="text" class="form-control"
                   name="emailserver" id="emailserver" required
                   placeholder="The email server to use for email sending"
                   minlength="5" maxlength="1024"
                   value="{{ siteinfo['email_server'] }}">
          </div>

          <div class="form-group" >
            <label for="emailport" >SMTP port for email server</label>
            <input type="text" class="form-control"
                   name="emailport" id="emailport" required
                   placeholder="The email port to use for email sending"
                   minlength="5" maxlength="1024"
                   value="{{ siteinfo['email_port'] }}">
          </div>

          <div class="form-group" >
            <label for="emailuser" >User name for email server</label>
            <input type="text" class="form-control"
                   name="emailuser" id="emailuser" required
                   placeholder="The user name for the email server"
                   minlength="5" maxlength="1024"
                   value="{{ siteinfo['email_user'] }}">
          </div>

          <div class="form-group" >
            <label for="emailpass" >Password for email server</label>
            <input type="password" class="form-control"
                   name="emailpass" id="emailpass" required
                   placeholder="The password for the email server"
                   minlength="5" maxlength="1024"
                   value="{{ siteinfo['email_pass'] }}">
          </div>

        </fieldset>

        <button type="submit" class="btn btn-primary" id="admin-email-update" >
          Update users and email server settings
        </button>

      </form>
    </div>

  </div>
  {% end %}


  <div class="row mt-4" >
    <div class="col-12">

      <h3>All recent datasets</h3>

      <table id="lcc-datasets-table" class="table table-hover table-sm">

        <thead class="bg-light">
          <tr>
            <th scope="col" width="100">Set ID</th>
            <th scope="col" width="80">Objects</th>
            <th scope="col" width="350">Query</th>
            <th scope="col" width="150">Products</th>
            <th scope="col" width="150">Last updated</th>
          </tr>
        </thead>

        <form action="/admin/datasets" method="post" id="admin-datasets-form" >
          {% module xsrf_form_html() %}
          <tbody id="lcc-datasets-tablerows">

          </tbody>
        </form>

      </table>

    </div>
  </div>

</div>

{% end %}

{% block pagejs_modules %}
<script src="{{ static_url('js/lcc-server-admin.js') }}"></script>
{% end %}

{% block pagejs %}

$(document).ready(function() {

// get the most recent 1000 datasets on the server
lcc_ui.get_recent_datasets(1000, null, false);

// UI action setup
lcc_ui.action_setup();

// admin action setup
lcc_admin.action_setup();

});

{% end %}
