{% extends 'base.html' %}

{% block pagecontent %}

<!-- this is where all the alerts go -->
<div class="container">
  <div class="row">
    <div class="col-12">
      <div id="alert-box">

      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row mt-2">
    <div class="col-3 ml-auto">
      <span id="setload-icon"></span> <span id="setload-indicator"></span>
    </div>
  </div>
</div>

<div class="container">

  <div class="row mt-2">
    <div class="col-12">

      <div class="accordion" id="accordionExample">

        <div class="card">
          <div class="card-header" id="headingOne">
            <h3 class="mb-0">
              <button class="btn btn-link collapsed" id="dataset-header"
                      type="button" data-toggle="collapse"
                      data-target="#collapseOne"
                      aria-expanded="false" aria-controls="collapseOne">
                Dataset
                <span id="dataset-setid" data-setid="{{ header['setid'] }}" >{{ header['setid'] }}</span>
                &mdash; <span id="dataset-status"><span class="text-info">{{ header['status'] }}</span></span>
              </button>
            </h3>
          </div>

          <div id="collapseOne" class="collapse"
               aria-labelledby="headingOne" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-borderless table-sm">

                <tr>
                  <th width="80">objects</th>
                  <td><span id="dataset-nobjects">{{ header['nobjects'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">created on</th>
                  <td><span class="moment-format" id="dataset-createdon">{{ header['created'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">last updated</th>
                  <td><span class="moment-format" id="dataset-lastupdated">{{ header['updated'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">dataset is public</th>
                  <td>{{ header['public'] }}</td>
                </tr>

                <tr>
                  <th width="200">search query parameters</th>
                  <td>
                    <code id="dataset-searchargs">
                      <details><summary>{{ header['searchtype'].replace('sqlite_','').replace('postgres_','') }}</summary>{{ header['searchargs'] }}</details>
                    </code>
                  </td>
                </tr>

                <tr>
                  <th width="200">collections searched</th>
                  <td><code id="dataset-collections">{{ ', '.join(header['collections']) }}</code></td>
                </tr>

              </table>

            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header" id="headingTwo">
            <h3 class="mb-0">
              <button class="btn btn-link collapsed"
                      type="button" data-toggle="collapse"
                      data-target="#collapseTwo"
                      aria-expanded="false" aria-controls="collapseTwo">
                Download data products
              </button>
            </h3>
          </div>
          <div id="collapseTwo" class="collapse"
               aria-labelledby="headingTwo" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-borderless table-sm">

                <tr>
                  <th width="200">dataset pickle</th>
                  {% if setpickle is not None %}
                  <td id="dataset-setpickle"><a rel="nofollow" href="{{ setpickle }}">download file</a></td>
                  <td id="dataset-picklesha">SHA256: <code>{{ setpickle_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-setpickle">not available yet...</a></td>
                  <td id="dataset-picklesha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">dataset table CSV</th>
                  {% if setcsv is not None %}
                  <td id="dataset-setcsv"><a rel="nofollow" href="{{ setcsv }}">download file</a></td>
                  <td id="dataset-csvsha">SHA256: <code>{{ setcsv_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-setcsv">not available yet...</td>
                  <td id="dataset-csvsha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">light curves ZIP</th>
                  {% if lczip is not None %}
                  <td id="dataset-lczip"><a rel="nofollow" href="{{ lczip }}">download file</a></td>
                  <td id="dataset-lcsha">SHA256: <code>{{ lczip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-lczip">not available yet...</td>
                  <td id="dataset-lcsha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">checkplot pickles ZIP</th>
                  {% if cpzip is not None %}
                  <td id="dataset-cpczip"><a rel="nofollow" href="{{ cpzip }}">download file</a></td>
                  <td id="dataset-cpsha">SHA256: <code>{{ cpzip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-cpzip">not available yet...</td>
                  <td id="dataset-cpsha"></code></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">period-finding results ZIP</th>
                  {% if pfzip is not None %}
                  <td id="dataset-pfzip"><a rel="nofollow" href="{{ pfzip }}">download file</a></td>
                  <td id="dataset-pfsha">SHA256: <code>{{ pfzip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-pfzip">not available yet...</td>
                  <td id="dataset-pfsha"></code></td>
                  {% end %}
                </tr>

              </table>

            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header" id="headingThree">
            <h3 class="mb-0">
              <button class="btn btn-link collapsed"
                      type="button" data-toggle="collapse"
                      data-target="#collapseThree"
                      aria-expanded="false" aria-controls="collapseThree">
                Data table column descriptions
              </button>
            </h3>
          </div>
          <div id="collapseThree" class="collapse"
               aria-labelledby="headingThree" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-striped table-sm">

                <thead class="bg-light">
                  <tr id="table-columndesc">
                    <th width="100">column key</th>
                    <th width="150">title</th>
                    <th width="350">description</th>
                    <th width="100">numpy dtype</th>
                  </tr>
                </thead>

                <tbody id="table-datarows">

                </tbody>

              </table>

            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>

<!-- the full table -->
<div class="container-fluid">

  <div class="row mt-4 datatable-container">
    <div class="col-12">

      <table id="lcc-datatable" class="table table-striped table-sm dataset-table">

        <thead class="bg-light">
          <tr id="lcc-datatable-header">

          </tr>
        </thead>

        <tbody id="lcc-datatable-datarows">

        </tbody>

      </table>

    </div>
  </div>

</div>

{% end %}


{% block pagejs_modules %}


{% end %}


{% block pagejs %}

$(document).ready(function() {


// UI action setup
lcc_ui.action_setup();

// format all the moments
$('.moment-format').each(function (index, elem) {

// get the text we need
var mt = moment($(this).text()).fromNow();
$(this).html($(this).text() + ' <strong>(' + mt + ')</strong>');

});

// start the dataset check every 15 seconds and load if available
lcc_datasets.get_dataset('{{ setid }}', 15.0);

});

{% end %}
