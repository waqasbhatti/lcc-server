{% extends 'base.html' %}

{% block pagecontent %}

<div class="container">

  <div class="row top-margin-row">
    <div class="col-12">

      <div class="accordion" id="accordionExample">

        <div class="card">
          <div class="card-header" id="headingOne">
            <h3 class="mb-0">
              <button class="btn btn-link"
                      type="button" data-toggle="collapse"
                      data-target="#collapseOne"
                      aria-expanded="true" aria-controls="collapseOne">
                Dataset metadata
              </button>
            </h3>
          </div>

          <div id="collapseOne" class="collapse show"
               aria-labelledby="headingOne" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-borderless table-sm">

                <tr>
                  <th width="200">dataset ID</th>
                  <td id="dataset-setid" data-setid="{{ header['setid'] }}">{{ header['setid'] }}</td>
                </tr>

                <tr>
                  <th width="200">created on</th>
                  <td><span class="moment-format" id="dataset-createdon">{{ header['created'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">last updated</th>
                  <td><span class="moment-format" id="dataset-lastupdated">{{ header['updated'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">status</th>
                  <td id="dataset-status"><span class="text-info">{{ header['status'] }}</span></td>
                </tr>

                <tr>
                  <th width="200">dataset is public</th>
                  <td>{{ header['public'] }}</td>
                </tr>

                <tr>
                  <th width="200">search query type</th>
                  <td><code id="dataset-searchtype">{{ header['searchtype'] }}</code></td>
                </tr>

                <tr>
                  <th width="200">search query parameters</th>
                  <td><code id="dataset-searchargs">{{ header['searchargs'] }}</code></td>
                </tr>

                <tr>
                  <th width="200">total objects found</th>
                  <td><code id="dataset-nobjects">{{ header['nobjects'] }}</code></td>
                </tr>

                <tr>
                  <th width="200">objects found in collections</th>
                  <td><code id="dataset-collections">{{ ', '.join(header['collections']) }}</code></td>
                </tr>

              </table>

            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header" id="headingTwo">
            <h3 class="mb-0">
              <button class="btn btn-link collapsed"
                      type="button" data-toggle="collapse"
                      data-target="#collapseTwo"
                      aria-expanded="false" aria-controls="collapseTwo">
                Download data products
              </button>
            </h3>
          </div>
          <div id="collapseTwo" class="collapse"
               aria-labelledby="headingTwo" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-borderless table-sm">

                <tr>
                  <th width="200">dataset pickle</th>
                  {% if setpickle is not None %}
                  <td id="dataset-setpickle"><a rel="nofollow" href="{{ setpickle }}">download file</a></td>
                  <td id="dataset-picklesha">SHA256: <code>{{ setpickle_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-setpickle">not available yet...</a></td>
                  <td id="dataset-picklesha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">dataset table CSV</th>
                  {% if setcsv is not None %}
                  <td id="dataset-setcsv"><a rel="nofollow" href="{{ setcsv }}">download file</a></td>
                  <td id="dataset-csvsha">SHA256: <code>{{ setcsv_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-setcsv">not available yet...</td>
                  <td id="dataset-csvsha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">light curves ZIP</th>
                  {% if lczip is not None %}
                  <td id="dataset-lczip"><a rel="nofollow" href="{{ lczip }}">download file</a></td>
                  <td id="dataset-lcsha">SHA256: <code>{{ lczip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-lczip">not available yet...</td>
                  <td id="dataset-lcsha"></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">checkplot pickles ZIP</th>
                  {% if cpzip is not None %}
                  <td id="dataset-cpczip"><a rel="nofollow" href="{{ cpzip }}">download file</a></td>
                  <td id="dataset-cpsha">SHA256: <code>{{ cpzip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-cpzip">not available yet...</td>
                  <td id="dataset-cpsha"></code></td>
                  {% end %}
                </tr>

                <tr>
                  <th width="200">period-finding results ZIP</th>
                  {% if pfzip is not None %}
                  <td id="dataset-pfzip"><a rel="nofollow" href="{{ pfzip }}">download file</a></td>
                  <td id="dataset-pfsha">SHA256: <code>{{ pfzip_shasum }}</code></td>
                  {% else %}
                  <td id="dataset-pfzip">not available yet...</td>
                  <td id="dataset-pfsha"></code></td>
                  {% end %}
                </tr>

              </table>

            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header" id="headingThree">
            <h3 class="mb-0">
              <button class="btn btn-link collapsed"
                      type="button" data-toggle="collapse"
                      data-target="#collapseThree"
                      aria-expanded="false" aria-controls="collapseThree">
                Data table column descriptions
              </button>
            </h3>
          </div>
          <div id="collapseThree" class="collapse"
               aria-labelledby="headingThree" data-parent="#accordionExample">
            <div class="card-body">

              <table class="table table-striped table-sm">

                <thead class="bg-light">
                  <tr id="table-columndesc">
                    <th width="100">column key</th>
                    <th width="150">title</th>
                    <th width="350">description</th>
                    <th width="100">numpy dtype</th>
                  </tr>
                </thead>

                <tbody id="table-datarows">
                  {% for col in header['columns'] %}
                  <tr>
                    <td width="100">
                      <code>{{ col }}</code>
                    </td>
                    <td width="150">
                      {% raw header['coldesc'][col]['title'] %}
                    </td>
                    <td width="350">
                      {% raw header['coldesc'][col]['desc'] %}
                    </td>
                    <td width="100">
                      <code>{{ header['coldesc'][col]['dtype'] }}</code>
                    </td>
                  </tr>
                  {% end %}

                </tbody>

              </table>

            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>

<!-- the full table -->
<div class="container-fluid">

  <div class="row mt-4 datatable-container">
    <div class="col-12">

      <table id="lcc-datatable" class="table table-striped table-sm dataset-table">


      </table>

    </div>
  </div>

</div>

{% end %}


{% block pagejs_modules %}


{% end %}


{% block pagejs %}

$(document).ready(function() {


// UI action setup
lcc_ui.action_setup();

// format all the moments
$('.moment-format').each(function (index, elem) {

// get the text we need
var mt = moment($(this).text()).fromNow();
$(this).html($(this).text() + ' <strong>(' + mt + ')</strong>');

});

// start the dataset check every 15 seconds and load if available
lcc_datasets.get_dataset('{{ setid }}', 15.0);

});

{% end %}
